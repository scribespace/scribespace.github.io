/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 */

'use strict';var m=require("lexical"),u=require("@lexical/code"),B=require("@lexical/list"),F=require("@lexical/rich-text"),aa=require("@lexical/utils"),G=require("@lexical/link");function H(a,b){let c={};for(let d of a)a=b(d),c[a]?c[a].push(d):c[a]=[d];return c}function I(a){a=H(a,b=>b.type);return{element:a.element||[],textFormat:a["text-format"]||[],textMatch:a["text-match"]||[]}}let J=/[!-/:-@[-`{-~\s]/,ba=/^\s{0,3}$/;
function K(a){if(!m.$isParagraphNode(a))return!1;let b=a.getFirstChild();return null==b||1===a.getChildrenSize()&&m.$isTextNode(b)&&ba.test(b.getTextContent())}function ca(a,b=!1){let c=I(a),d=!b,f=c.textFormat.filter(e=>1===e.format.length);return e=>{let k=[];e=(e||m.$getRoot()).getChildren();for(let g=0;g<e.length;g++){let p=e[g],v=da(p,c.element,f,c.textMatch);null!=v&&k.push(d&&0<g&&!K(p)&&!K(e[g-1])?"\n".concat(v):v)}return k.join("\n")}}
function da(a,b,c,d){for(let f of b)if(b=f.export(a,e=>L(e,c,d)),null!=b)return b;return m.$isElementNode(a)?L(a,c,d):m.$isDecoratorNode(a)?a.getTextContent():null}
function L(a,b,c){let d=[];a=a.getChildren();a:for(let f of a){for(let e of c)if(a=e.export(f,k=>L(k,b,c),(k,g)=>M(k,g,b)),null!=a){d.push(a);continue a}m.$isLineBreakNode(f)?d.push("\n"):m.$isTextNode(f)?d.push(M(f,f.getTextContent(),b)):m.$isElementNode(f)?d.push(L(f,b,c)):m.$isDecoratorNode(f)&&d.push(f.getTextContent())}return d.join("")}
function M(a,b,c){let d=b.trim(),f=d,e=new Set;for(let g of c){c=g.format[0];let p=g.tag;if(N(a,c)&&!e.has(c)){e.add(c);var k=O(a,!0);N(k,c)||(f=p+f);k=O(a,!1);N(k,c)||(f+=p)}}return b.replace(d,()=>f)}
function O(a,b){let c=b?a.getPreviousSibling():a.getNextSibling();c||(a=a.getParentOrThrow(),a.isInline()&&(c=b?a.getPreviousSibling():a.getNextSibling()));for(;c;){if(m.$isElementNode(c)){if(!c.isInline())break;a=b?c.getLastDescendant():c.getFirstDescendant();if(m.$isTextNode(a))return a;c=b?c.getPreviousSibling():c.getNextSibling()}if(m.$isTextNode(c))return c;if(!m.$isElementNode(c))break}return null}function N(a,b){return m.$isTextNode(a)&&a.hasFormat(b)}
let P="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement,ea=P&&"documentMode"in document?document.documentMode:null;P&&"InputEvent"in window&&!ea?"getTargetRanges"in new window.InputEvent("input"):!1;
let Q=P&&/Version\/[\d.]+.*Safari/.test(navigator.userAgent),R=P&&/iPad|iPhone|iPod/.test(navigator.userAgent)&&!window.MSStream,fa=P&&/^(?=.*Chrome).*/i.test(navigator.userAgent),S=P&&/AppleWebKit\/[\d.]+/.test(navigator.userAgent)&&!fa,T=/^[ \t]*```(\w{1,10})?\s?$/;
function ha(a,b=!1){let c=I(a),d=ia(c.textFormat);return(f,e)=>{f=f.split("\n");let k=f.length;e=e||m.$getRoot();e.clear();for(let h=0;h<k;h++){var g=f[h];a:{var p=f,v=h;var r=e;var q=p[v].match(T);if(q)for(var l=v,t=p.length;++l<t;)if(p[l].match(T)){q=u.$createCodeNode(q[1]);p=m.$createTextNode(p.slice(v+1,l).join("\n"));q.append(p);r.append(q);r=[q,l];break a}r=[null,v]}let [x,y]=r;if(null!=x)h=y;else{r=g;t=e;var n=c.element;l=d;p=c.textMatch;v=r.trim();q=m.$createTextNode(v);g=m.$createParagraphNode();
g.append(q);t.append(g);for(let {regExp:w,replace:z}of n)if(t=r.match(w)){q.setTextContent(r.slice(t[0].length));z(g,[q],t,!0);break}U(q,l,p);g.isAttached()&&0<v.length&&(r=g.getPreviousSibling(),m.$isParagraphNode(r)||F.$isQuoteNode(r)||B.$isListNode(r))&&(l=r,B.$isListNode(r)&&(r=r.getLastDescendant(),l=null==r?null:aa.$findMatchingParent(r,B.$isListItemNode)),null!=l&&0<l.getTextContentSize()&&(l.splice(l.getChildrenSize(),0,[m.$createLineBreakNode(),...g.getChildren()]),g.remove()))}}f=e.getChildren();
for(let h of f)!b&&K(h)&&1<e.getChildrenSize()&&h.remove();null!==m.$getSelection()&&e.selectStart()}}function U(a,b,c){var d=a.getTextContent();let f=ja(d,b);if(f){var e,k;if(f[0]===d)var g=a;else{d=f.index||0;let p=d+f[0].length;0===d?[g,e]=a.splitText(p):[k,g,e]=a.splitText(d,p)}g.setTextContent(f[2]);if(a=b.transformersByTag[f[1]])for(let p of a.format)g.hasFormat(p)||g.toggleFormat(p);g.hasFormat("code")||U(g,b,c);k&&U(k,b,c);e&&U(e,b,c)}else V(a,c)}
function V(a,b){a:for(;a;){for(let c of b){let d=a.getTextContent().match(c.importRegExp);if(!d)continue;let f=d.index||0,e=f+d[0].length,k,g;0===f?[k,a]=a.splitText(e):[,k,g]=a.splitText(f,e);g&&V(g,b);c.replace(k,d);continue a}break}}
function ja(a,b){var c=a.match(b.openTagsRegExp);if(null==c)return null;for(let e of c){var d=e.replace(/^\s/,"");c=b.fullMatchRegExpByTag[d];if(null!=c&&(c=a.match(c),d=b.transformersByTag[d],null!=c&&null!=d)){if(!1!==d.intraword)return c;var {index:f=0}=c;d=a[f-1];f=a[f+c[0].length];if(!(d&&!J.test(d)||f&&!J.test(f)))return c}}return null}
function ia(a){let b={},c={},d=[];for(let f of a){({tag:a}=f);b[a]=f;let e=a.replace(/(\*|\^|\+)/g,"\\$1");d.push(e);c[a]=Q||R||S?new RegExp(`(${e})(?![${e}\\s])(.*?[^${e}\\s])${e}(?!${e})`):new RegExp(`(?<![\\\\${e}])(${e})((\\\\${e})?.*?[^${e}\\s](\\\\${e})?)((?<!\\\\)|(?<=\\\\\\\\))(${e})(?![\\\\${e}])`)}return{fullMatchRegExpByTag:c,openTagsRegExp:new RegExp((Q||R||S?"":"(?<![\\\\])")+"("+d.join("|")+")","g"),transformersByTag:b}}var ka;
function W(a){let b=new URLSearchParams;b.append("code",a);for(let c=1;c<arguments.length;c++)b.append("v",arguments[c]);throw Error(`Minified Lexical error #${a}; visit https://lexical.dev/docs/error?${b} for the full message or `+"use the non-minified dev environment for full errors and additional helpful warnings.");}ka=W&&W.__esModule&&Object.prototype.hasOwnProperty.call(W,"default")?W["default"]:W;
function la(a,b,c){let d=c.length;for(;b>=d;b--){let f=b-d;if(ma(a,f,c,0,d)&&" "!==a[f+d])return f}return-1}function ma(a,b,c,d,f){for(let e=0;e<f;e++)if(a[b+e]!==c[d+e])return!1;return!0}
let na=a=>(b,c,d)=>{d=a(d);d.append(...c);b.replace(d);d.select(0,0)},X=a=>(b,c,d)=>{var f=b.getPreviousSibling(),e=b.getNextSibling();const k=B.$createListItemNode("check"===a?"x"===d[3]:void 0);B.$isListNode(e)&&e.getListType()===a?(f=e.getFirstChild(),null!==f?f.insertBefore(k):e.append(k),b.remove()):B.$isListNode(f)&&f.getListType()===a?(f.append(k),b.remove()):(e=B.$createListNode(a,"number"===a?Number(d[2]):void 0),e.append(k),b.replace(e));k.append(...c);k.select(0,0);c=d[1];b=c.match(/\t/g);
c=c.match(/ /g);d=0;b&&(d+=b.length);c&&(d+=Math.floor(c.length/4));(b=d)&&k.setIndent(b)},Y=(a,b,c)=>{const d=[];var f=a.getChildren();let e=0;for(const g of f)if(B.$isListItemNode(g)){if(1===g.getChildrenSize()&&(f=g.getFirstChild(),B.$isListNode(f))){d.push(Y(f,b,c+1));continue}f=" ".repeat(4*c);var k=a.getListType();k="number"===k?`${a.getStart()+e}. `:"check"===k?`- [${g.getChecked()?"x":" "}] `:"- ";d.push(f+k+b(g));e++}return d.join("\n")},oa={dependencies:[F.HeadingNode],export:(a,b)=>{if(!F.$isHeadingNode(a))return null;
const c=Number(a.getTag().slice(1));return"#".repeat(c)+" "+b(a)},regExp:/^(#{1,6})\s/,replace:na(a=>F.$createHeadingNode("h"+a[1].length)),type:"element"},pa={dependencies:[F.QuoteNode],export:(a,b)=>{if(!F.$isQuoteNode(a))return null;a=b(a).split("\n");b=[];for(const c of a)b.push("> "+c);return b.join("\n")},regExp:/^>\s/,replace:(a,b,c,d)=>{if(d&&(c=a.getPreviousSibling(),F.$isQuoteNode(c))){c.splice(c.getChildrenSize(),0,[m.$createLineBreakNode(),...b]);c.select(0,0);a.remove();return}c=F.$createQuoteNode();
c.append(...b);a.replace(c);c.select(0,0)},type:"element"},qa={dependencies:[u.CodeNode],export:a=>{if(!u.$isCodeNode(a))return null;const b=a.getTextContent();return"```"+(a.getLanguage()||"")+(b?"\n"+b:"")+"\n```"},regExp:/^[ \t]*```(\w{1,10})?\s/,replace:na(a=>u.$createCodeNode(a?a[1]:void 0)),type:"element"},ra={dependencies:[B.ListNode,B.ListItemNode],export:(a,b)=>B.$isListNode(a)?Y(a,b,0):null,regExp:/^(\s*)[-*+]\s/,replace:X("bullet"),type:"element"},sa={dependencies:[B.ListNode,B.ListItemNode],
export:(a,b)=>B.$isListNode(a)?Y(a,b,0):null,regExp:/^(\s*)(?:-\s)?\s?(\[(\s|x)?\])\s/i,replace:X("check"),type:"element"},ta={dependencies:[B.ListNode,B.ListItemNode],export:(a,b)=>B.$isListNode(a)?Y(a,b,0):null,regExp:/^(\s*)(\d{1,})\.\s/,replace:X("number"),type:"element"},ua={format:["code"],tag:"`",type:"text-format"},va={format:["highlight"],tag:"==",type:"text-format"},wa={format:["bold","italic"],tag:"***",type:"text-format"},ya={format:["bold","italic"],intraword:!1,tag:"___",type:"text-format"},
za={format:["bold"],tag:"**",type:"text-format"},Aa={format:["bold"],intraword:!1,tag:"__",type:"text-format"},Ba={format:["strikethrough"],tag:"~~",type:"text-format"},Ca={format:["italic"],tag:"*",type:"text-format"},Da={format:["italic"],intraword:!1,tag:"_",type:"text-format"},Ea={dependencies:[G.LinkNode],export:(a,b,c)=>{if(!G.$isLinkNode(a))return null;b=(b=a.getTitle())?`[${a.getTextContent()}](${a.getURL()} "${b}")`:`[${a.getTextContent()}](${a.getURL()})`;const d=a.getFirstChild();return 1===
a.getChildrenSize()&&m.$isTextNode(d)?c(d,b):b},importRegExp:/(?:\[([^[]+)\])(?:\((?:([^()\s]+)(?:\s"((?:[^"]*\\")*[^"]*)"\s*)?)\))/,regExp:/(?:\[([^[]+)\])(?:\((?:([^()\s]+)(?:\s"((?:[^"]*\\")*[^"]*)"\s*)?)\))$/,replace:(a,b)=>{const [,c,d,f]=b;b=G.$createLinkNode(d,{title:f});const e=m.$createTextNode(c);e.setFormat(a.getFormat());b.append(e);a.replace(b)},trigger:")",type:"text-match"},Fa=[oa,pa,qa,ra,ta],Ga=[ua,wa,ya,za,Aa,va,Ca,Da,Ba],Ha=[Ea],Z=[...Fa,...Ga,...Ha];
exports.$convertFromMarkdownString=function(a,b=Z,c,d=!1){return ha(b,d)(a,c)};exports.$convertToMarkdownString=function(a=Z,b,c=!1){return ca(a,c)(b)};exports.BOLD_ITALIC_STAR=wa;exports.BOLD_ITALIC_UNDERSCORE=ya;exports.BOLD_STAR=za;exports.BOLD_UNDERSCORE=Aa;exports.CHECK_LIST=sa;exports.CODE=qa;exports.ELEMENT_TRANSFORMERS=Fa;exports.HEADING=oa;exports.HIGHLIGHT=va;exports.INLINE_CODE=ua;exports.ITALIC_STAR=Ca;exports.ITALIC_UNDERSCORE=Da;exports.LINK=Ea;exports.ORDERED_LIST=ta;
exports.QUOTE=pa;exports.STRIKETHROUGH=Ba;exports.TEXT_FORMAT_TRANSFORMERS=Ga;exports.TEXT_MATCH_TRANSFORMERS=Ha;exports.TRANSFORMERS=Z;exports.UNORDERED_LIST=ra;
exports.registerMarkdownShortcuts=function(a,b=Z){let c=I(b),d=H(c.textFormat,({tag:e})=>e[e.length-1]),f=H(c.textMatch,({trigger:e})=>e);for(let e of b)if(b=e.type,"element"===b||"text-match"===b){b=e.dependencies;for(let k of b)a.hasNode(k)||ka(88,k.getType())}return a.registerUpdateListener(({tags:e,dirtyLeaves:k,editorState:g,prevEditorState:p})=>{if(!e.has("collaboration")&&!e.has("historic")&&!a.isComposing()){var v=g.read(m.$getSelection);e=p.read(m.$getSelection);if(m.$isRangeSelection(e)&&
m.$isRangeSelection(v)&&v.isCollapsed()){p=v.anchor.key;var r=v.anchor.offset,q=g._nodeMap.get(p);!m.$isTextNode(q)||!k.has(p)||1!==r&&r>e.anchor.offset+1||a.update(()=>{if(!q.hasFormat("code")){var l=q.getParent();if(null!==l&&!u.$isCodeNode(l)){var t=v.anchor.offset;b:{var n=c.element,h=l.getParent();if(m.$isRootOrShadowRoot(h)&&l.getFirstChild()===q&&(h=q.getTextContent()," "===h[t-1]))for(let {regExp:C,replace:D}of n)if((n=h.match(C))&&n[0].length===t){h=q.getNextSiblings();let [E,xa]=q.splitText(t);
E.remove();h=xa?[xa,...h]:h;D(l,h,n,!1);l=!0;break b}l=!1}if(!l){b:{n=q.getTextContent();l=f[n[t-1]];if(null!=l){t<n.length&&(n=n.slice(0,t));for(y of l)if(l=n.match(y.regExp),null!==l){n=l.index||0;h=n+l[0].length;var x=void 0;0===n?[x]=q.splitText(h):[,x]=q.splitText(n,h);x.selectNext(0,0);y.replace(x,l);var y=!0;break b}}y=!1}if(!y)b:{h=q.getTextContent();--t;var w=h[t];if(y=d[w])for(let C of y){var {tag:z}=C;y=z.length;let D=t-y+1;if(!(1<y&&!ma(h,D,z,0,y)||" "===h[D-1])&&(x=h[t+1],!1!==C.intraword||
!x||J.test(x))){l=x=q;n=la(h,D,z);for(var A=l;0>n&&(A=A.getPreviousSibling())&&!m.$isLineBreakNode(A);)m.$isTextNode(A)&&(n=A.getTextContent(),l=A,n=la(n,n.length,z));if(!(0>n||l===x&&n+y===D||(z=l.getTextContent(),0<n&&z[n-1]===w||(A=z[n-1],!1===C.intraword&&A&&!J.test(A))))){h=x.getTextContent();h=h.slice(0,D)+h.slice(t+1);x.setTextContent(h);h=l===x?h:z;l.setTextContent(h.slice(0,n)+h.slice(n+y));h=m.$getSelection();w=m.$createRangeSelection();m.$setSelection(w);t=t-y*(l===x?2:1)+1;w.anchor.set(l.__key,
n,"text");w.focus.set(x.__key,t,"text");for(let E of C.format)w.hasFormat(E)||w.formatText(E);w.anchor.set(w.focus.key,w.focus.offset,w.focus.type);for(let E of C.format)w.hasFormat(E)&&w.toggleFormat(E);m.$isRangeSelection(h)&&(w.format=h.format);break b}}}}}}}})}}})}
